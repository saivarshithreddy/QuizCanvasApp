BEGIN;

CREATE TABLE T_QUIZ (
    ID UUID NOT NULL,
    TITLE VARCHAR NOT NULL,
    DESCRIPTION VARCHAR NOT NULL,
    TAGS VARCHAR NOT NULL,
    THUMBNAIL VARCHAR NOT NULL,
    CONSTRAINT QUIZ_PK PRIMARY KEY (ID)
);

CREATE TABLE T_QUIZ_QUESTION (
    ID UUID NOT NULL,
    QUIZ_ID UUID,
    QUESTION VARCHAR NOT NULL,
    OPTIONS VARCHAR NOT NULL,
    ANSWER_INDEX INTEGER NOT NULL,
    CONSTRAINT QUIZ_QUESTION_PK PRIMARY KEY (ID)
);

CREATE TABLE T_QUIZ_PLAY (
    USER_ID UUID NOT NULL,
    QUIZ_ID UUID NOT NULL,
    PLAYED_AT TIMESTAMP NOT NULL,
    CORRECT_QUESTIONS_NUMBER INTEGER NOT NULL,
    CONSTRAINT QUIZ_RESULT_PK PRIMARY KEY (USER_ID, QUIZ_ID)
);

CREATE TABLE T_USER (
    ID UUID NOT NULL,
    EMAIL VARCHAR NOT NULL,
    PROVIDER VARCHAR NOT NULL,
    NAME VARCHAR NOT NULL,
    IMAGE VARCHAR NOT NULL,
    REFRESH_TOKEN VARCHAR,
    REFRESH_TOKEN_CREATED_AT TIMESTAMP,
    CONSTRAINT USERS_PK PRIMARY KEY (ID)
);

ALTER TABLE T_QUIZ_QUESTION ADD CONSTRAINT QUIZ_QUESTION_QUIZ_ID_FK
FOREIGN KEY (QUIZ_ID)
REFERENCES T_QUIZ (ID);

ALTER TABLE T_QUIZ_PLAY ADD CONSTRAINT QUIZ_PLAYER_QUIZ_ID_FK
FOREIGN KEY (QUIZ_ID)
REFERENCES T_QUIZ (ID);

ALTER TABLE T_QUIZ_PLAY ADD CONSTRAINT QUIZ_PLAYER_USER_ID_FK
FOREIGN KEY (USER_ID)
REFERENCES T_USER (ID);

COMMIT;